---
title: "Imprecise Inference under Complete Prior Ignorance"
author: "Chel Hee Lee"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{example}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6, fig.height=6)
```

```{r setup}
rm(list=ls())
library(imprecise101)
```


## Imprecise Dirichlet Model 

We draw a sequence of marbles whose colours are (in order): blue, green, blue, blue, green, red. What conclusions can you reach about the probability of drawing a red marble on a future trial? 

If $\Omega = \{R, B, G, O\}$, then $n = (1, 3, 2, 0)$ and $L(\theta|n) \propto \theta_R \theta_B^3 \theta_G^2$. 

### 4.1. Probabilities of Future Outcomes 

The simplest way of stating our conclusion is to report the posterior upper and lower probabilities of obtaining red on the next trial. 

Using $s=2$, $\overline{P}(R|n)=0.375$ and $\underline{P}(R|n)=0.125$
```{r}
op <- idm(nj=1, s=2, N=6, k=4)
c(op$p.lower, op$p.upper)
```

For $s=1$, $\overline{P}(R|n)=0.286$ and $\underline{P}(R|n)=0.143$. 
```{r}
op <- idm(nj=1, s=1, N=6, k=4)
round(c(op$p.lower, op$p.upper),3)
```

For the improper prior density ($s=0$) which gives $P(R|n)=0.167$ irrespective of $\Omega$. 

```{r}
op <- idm(nj=1, s=0, N=6, k=4)
round(c(op$p.lower, op$p.upper),3)
```

Three possible sample spaces are $\Omega_1=\{R,B,G,O\}$, $\Omega_2=\{R, O\}$, and $\Omega_3=\{LR, DR, O\}$. The parameter values $s=1,2,k/2$, and $k$, where $k$ is the number of elements in $\Omega$. 

```{r}
# Omega1
idm(nj=1, s=1, N=6, k=4)$p
idm(nj=1, s=2, N=6, k=4)$p
idm(nj=1, s=4/2, N=6, k=4)$p
idm(nj=1, s=4, N=6, k=4)$p

# Omega2
idm(nj=1, s=1, N=6, k=2)$p
idm(nj=1, s=2, N=6, k=2)$p
idm(nj=1, s=2/2, N=6, k=2)$p
idm(nj=1, s=2, N=6, k=2)$p

# Omega3
idm(nj=1, s=1, N=6, k=3, cA=2)$p
idm(nj=1, s=2, N=6, k=3, cA=2)$p
idm(nj=1, s=3/2, N=6, k=3, cA=2)$p
idm(nj=1, s=3, N=6, k=3, cA=2)$p

```

Inferences can also be made about the number of red marbles that will be drawn in $M$ future trials. 

```{r}
mat <- rbind(
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=0)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=1)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=2)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=3)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=4)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=5)),
  unlist(pbetabinom(M=6, x=1, s=1, N=6, y=6))
)
rownames(mat) <- c("y=0", "y=1", "y=2", "y=3", "y=4", "y=5", "y=6")
round(mat, 3)
```

### 4.2 Means and Standard Deviations for $\theta_R$

Taking $s=2$, $\overline{E}(\theta_R|n) = 0.375$, $\underline{E}(\theta_R|n)=0.125$, $\overline{\sigma}(\theta_R|n)=0.188$, and $\underline{\sigma}(\theta_R|n)=0.110$. 

Taking $s=1$, $\overline{E}(\theta_R|n) = 0.286$, $\underline{E}(\theta_R|n)=0.143$, $\overline{\sigma}(\theta_R|n)=0.164$, and $\underline{\sigma}(\theta_R|n)=0.124$. 

```{r}
op <- idm(nj=1, s=2, N=6, k=4)
round(c(op$p.upper, op$p.lower, op$s.upper, op$s.lower),3)

op <- idm(nj=1, s=1, N=6, k=4)
round(c(op$p.upper, op$p.lower, op$s.upper, op$s.lower),3)
```

### 4.3 Credible Intervals for $\theta_R$

```{r}
round(hpd(alpha=3, beta=5, p=0.95),4) # s=2
round(hpd(alpha=3, beta=5, p=0.90),4) # s=2
round(hpd(alpha=3, beta=5, p=0.50),4) # s=2 (required for message of failure)
round(hpd(alpha=2, beta=5, p=0.95),4) # s=1
round(hpd(alpha=2, beta=5, p=0.90),4) # s=1
round(hpd(alpha=2, beta=5, p=0.50),4) # s=1
```

```{r}
library(pscl)
x <- betaHPD(alpha=2, beta=6, p=0.95, plot=FALSE)
round(x,4)
```

### 4.4 Testing Hypotheses about $\theta_R$

$H_0: \theta_R \ge 1/2$ vs $H_a: \theta_R < 1/2$.

```{r}
fn <- function(x) choose(7,1)*(1-x)^6
integrate(f=fn, lower=1/2, upper=1)$value

fn <- function(x) dbeta(x, 3, 5)
integrate(f=fn, lower=1/2, upper=1)$value 
```


## Imprecise Beta Model 

```{r out.width="45%", echo=FALSE}
tc <- seq(0,1,0.1)
s <- 2

ibm(n=10, m=6, xlab1="z", main1=expression(paste("Fig 1. Posterior ", theta[c], " based on ", s==2)))
ibm(n=9, m=9, xlab1="z", main1=expression(paste("Fig 2. Posterior ", theta[e], " based on ", s==2)))


x <- seq(-0.99, 0.99, 0.02)
ymax <- ymin <- numeric(length(x))
for(i in 1:length(x)) ymin[i] <- dbetadif(x=x[i], a1=9,b1=2,a2=8,b2=4)
for(i in 1:length(x)) ymax[i] <- dbetadif(x=x[i], a1=11,b1=0.01,a2=6,b2=6)

plot(x=x, y=1-cumsum(ymin)/sum(ymin), type="l", ylab="G(z)", xlab="z", main=expression(paste("Fig 3. ", psi, "=", theta[e]-theta[c], " Walley 1996 p.496" )))
points(x=x, y=1-cumsum(ymax)/sum(ymax), type="l")
```

```{r}
dmin <- 1-cumsum(ymin/sum(ymin))
dmax <- 1-cumsum(ymax/sum(ymax))
```

Since the imprecision is the area between lower and upper probabilities, $A = \overline{E} - \underline{E}$ =`r sum((dmax - dmin)*0.02)`
